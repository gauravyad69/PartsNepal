<div class="container mt-4">
  @if (isLoading) {
    <div class="text-center">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  } @else if (!order) {
    <div class="alert alert-warning">Order not found</div>
  } @else {
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h3>Order #{{order.orderNumber}}</h3>
        <button class="btn btn-primary" (click)="toggleEdit()">
          {{isEditing ? 'Save Changes' : 'Edit Order'}}
        </button>
      </div>
      
      <div class="card-body">
        <!-- Order Status -->
        <div class="mb-4">
          <h5>Order Status</h5>
          @if (isEditing) {
            <select class="form-select" [(ngModel)]="order.status"
                    (change)="updateOrderStatus($event)">
              @for (status of OrderStatus | keyvalue; track status.key) {
                <option [value]="status.value">{{status.value}}</option>
              }
            </select>
          } @else {
            <span [class]="'badge ' + getStatusClass(order.status)">
              {{order.status}}
            </span>
          }
        </div>

        <!-- Customer Information -->
        <div class="mb-4">
          <h5>Customer Information</h5>
          <div class="row">
            <div class="col-md-6">
              <p><strong>Name:</strong> {{order.customer.name}}</p>
              <p><strong>Type:</strong> {{order.customer.type}}</p>
            </div>
          </div>
        </div>

        <!-- Shipping Details -->
        <div class="mb-4">
          <h5>Shipping Details</h5>
          <div class="row">
            <div class="col-md-6">
              <p><strong>Recipient:</strong> {{order.shippingDetails.address.recipient.name}}</p>
              <p><strong>Phone:</strong> {{order.shippingDetails.address.recipient.phone}}</p>
              <p><strong>Address:</strong> {{order.shippingDetails.address.street}},
                {{order.shippingDetails.address.city}}, {{order.shippingDetails.address.province}}</p>
              <p><strong>Method:</strong> {{order.shippingDetails.method}}</p>
            </div>
          </div>
        </div>

        <!-- Order Items -->
        <div class="mb-4">
          <h5>Order Items</h5>
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Quantity</th>
                  <th>Unit Price</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                @for (item of order.items; track item.id) {
                  <tr>
                    <td>{{item.name}}</td>
                    <td>{{item.quantity}}</td>
                    <td>{{formatMoney(item.unitPrice.amount)}}</td>
                    <td>{{formatMoney(item.totalPrice?.amount ?? 0)}}</td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </div>

        <!-- Order Summary -->
        <div class="mb-4">
          <h5>Order Summary</h5>
          <div class="row">
            <div class="col-md-6 ms-auto">
              <table class="table table-borderless">
                <tr>
                  <td>Subtotal:</td>
                  <td class="text-end">{{formatMoney(order.summary.subtotal.amount)}}</td>
                </tr>
                @if (order.summary.discount) {
                  <tr>
                    <td>Discount:</td>
                    <td class="text-end">-{{formatMoney(order.summary.discount.amount)}}</td>
                  </tr>
                }
                <tr>
                  <td>Shipping:</td>
                  <td class="text-end">{{formatMoney(order.summary.shippingCost.amount)}}</td>
                </tr>
                @if (order.summary.tax) {
                  <tr>
                    <td>Tax:</td>
                    <td class="text-end">{{formatMoney(order.summary.tax.amount)}}</td>
                  </tr>
                }
                <tr class="fw-bold">
                  <td>Total:</td>
                  <td class="text-end">{{formatMoney(order.summary.total.amount)}}</td>
                </tr>
              </table>
            </div>
          </div>
        </div>

        <!-- Order Tracking -->
        <div class="mb-4">
          <h5>Order Timeline</h5>
          <div class="timeline">
            @for (event of order.tracking.events; track event.timestamp) {
              <div class="timeline-item">
                <div class="timeline-badge" [class]="getStatusClass(event.status)"></div>
                <div class="timeline-content">
                  <h6>{{event.status}}</h6>
                  @if (event.description) {pe
                    <p class="text-muted">{{event.description}}</p>
                  }
                </div>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  }
</div>